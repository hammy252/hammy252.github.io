<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HFrEF GDMT Suggestion Tool</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; @apply bg-slate-100; }
        label { @apply block text-sm font-medium text-slate-700 mb-1; }
        input[type="number"], input[type="text"], select {
            @apply mt-1 block w-full rounded-md border-slate-300 shadow-sm focus:border-blue-500 focus:ring focus:ring-blue-500 focus:ring-opacity-50 sm:text-sm p-2.5 bg-white text-slate-900;
        }
        input[type="checkbox"] {
            @apply h-4 w-4 text-blue-600 border-slate-300 rounded focus:ring-blue-500 focus:ring-offset-0 focus:ring-2;
        }
        .checkbox-container { @apply flex items-center; }
        .checkbox-label { @apply ml-2 text-sm text-slate-800 cursor-pointer; }
        fieldset { @apply border border-slate-200 p-5 rounded-lg shadow-sm bg-white; }
        legend { @apply text-lg font-semibold text-slate-800 px-2 -ml-2; }
        .input-group { @apply flex flex-col justify-end; }
        .fieldset-grid { @apply grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-x-6 gap-y-5 mt-3; } /* Use 3 columns */
        .fieldset-grid > div { @apply flex flex-col; }

        .result-box { @apply mt-8 p-6 bg-blue-50 border border-blue-300 rounded-lg shadow-md space-y-5; }
        .result-section-title { @apply text-base font-semibold text-blue-900 border-b border-blue-200 pb-1 mb-2; }
        .result-list { @apply list-disc list-inside pl-1 space-y-1 text-sm text-slate-700; }
        .result-list li strong { @apply font-medium text-slate-800; }
        /* Updated span classes for notes and caveats */
        .result-list li span.caveat { @apply text-xs text-red-600 italic ml-1; }
        .result-list li span.note { @apply text-xs text-gray-600 italic ml-1; }

        .disclaimer { @apply mt-5 text-xs text-slate-500 border-t border-slate-200 pt-3; }
        button { @apply px-6 py-2.5 text-sm font-medium rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-offset-2 transition duration-150 ease-in-out disabled:opacity-60 disabled:cursor-not-allowed; }
        button#suggest-btn { @apply bg-blue-600 text-white hover:bg-blue-700 focus:ring-blue-500; }
        button#reset-btn { @apply bg-slate-200 text-slate-800 hover:bg-slate-300 focus:ring-slate-400; }
        .button-container-box { @apply mt-8 pt-6 pb-4 px-4 bg-slate-50 border border-slate-200 rounded-lg shadow-sm; }
        .main-container { @apply max-w-5xl mx-auto bg-gradient-to-b from-white to-slate-50 p-6 md:p-8 rounded-xl shadow-xl border border-slate-200; } /* Wider container */
        .main-title { @apply text-3xl font-bold text-slate-800 mb-2 text-center; }
        .sub-title { @apply text-base text-slate-600 mb-8 text-center; }
    </style>
</head>
<body class="p-4 md:p-8">
    <div class="main-container">
        <h1 class="main-title">HFrEF GDMT Suggestion Tool</h1>
        <p class="sub-title">Enter patient details to see potential guideline-directed therapies *in addition* to foundational GDMT (ARNI/ACEi/ARB, Beta-Blocker, MRA, SGLT2i).</p>

        <form id="hfref-form" class="space-y-6">

            <fieldset>
                <legend>Patient Status & Vitals</legend>
                <div class="fieldset-grid">
                    <div class="input-group">
                        <label for="lvef">LVEF (%):</label>
                        <input type="number" id="lvef" name="lvef" placeholder="e.g., 30">
                    </div>
                    <div class="input-group">
                        <label for="nyha_class">NYHA Class:</label>
                        <select id="nyha_class" name="nyha_class">
                            <option value="">Select...</option>
                            <option value="I">I</option>
                            <option value="II">II</option>
                            <option value="III">III</option>
                            <option value="IV">IV</option>
                        </select>
                    </div>
                    <div class="input-group">
                        <label for="heart_rate">Heart Rate (bpm):</label>
                        <input type="number" id="heart_rate" name="heart_rate" placeholder="e.g., 75">
                    </div>
                    <div class="input-group">
                        <label for="qrs_duration">QRS Duration (ms):</label>
                        <input type="number" id="qrs_duration" name="qrs_duration" placeholder="e.g., 160">
                    </div>
                     <div class="checkbox-container pt-6">
                        <input type="checkbox" id="sinus_rhythm" name="sinus_rhythm" checked> 
                        <label for="sinus_rhythm" class="checkbox-label">Sinus Rhythm?</label>
                    </div>
                     <div class="checkbox-container pt-6">
                        <input type="checkbox" id="lbbb" name="lbbb">
                        <label for="lbbb" class="checkbox-label">LBBB Present?</label>
                    </div>
                     <div class="checkbox-container pt-6">
                        <input type="checkbox" id="afib" name="afib">
                        <label for="afib" class="checkbox-label">Atrial Fibrillation Present?</label>
                    </div>
                    <div class="checkbox-container pt-6">
                        <input type="checkbox" id="congestion" name="congestion">
                        <label for="congestion" class="checkbox-label">Currently Congested / Symptomatic?</label>
                    </div>
                    <div class="checkbox-container pt-6">
                        <input type="checkbox" id="on_max_bb" name="on_max_bb">
                        <label for="on_max_bb" class="checkbox-label">On Maximally Tolerated Beta-Blocker?</label>
                    </div>
                     <div class="checkbox-container pt-6">
                        <input type="checkbox" id="on_optimal_gdmt" name="on_optimal_gdmt">
                        <label for="on_optimal_gdmt" class="checkbox-label">On Optimal Foundational GDMT?</label>
                    </div>
                </div>
            </fieldset>

            <fieldset>
                <legend>Specific Conditions & Demographics</legend>
                 <div class="fieldset-grid">
                     <div class="checkbox-container pt-6">
                        <input type="checkbox" id="black_race" name="black_race">
                        <label for="black_race" class="checkbox-label">Black Race (Self-identified)?</label>
                    </div>
                    <div class="checkbox-container pt-6">
                        <input type="checkbox" id="iron_deficiency" name="iron_deficiency">
                        <label for="iron_deficiency" class="checkbox-label">Iron Deficient (Ferritin <100 or TSAT <20%)?</label>
                    </div>
                     <div class="checkbox-container pt-6">
                        <input type="checkbox" id="diabetes_t2dm" name="diabetes_t2dm">
                        <label for="diabetes_t2dm" class="checkbox-label">Type 2 Diabetes Mellitus?</label>
                    </div>
                     <div class="checkbox-container pt-6">
                        <input type="checkbox" id="ckd" name="ckd">
                        <label for="ckd" class="checkbox-label">CKD Present?</label>
                    </div>
                    <div class="checkbox-container pt-6">
                        <input type="checkbox" id="angioedema_acei" name="angioedema_acei">
                        <label for="angioedema_acei" class="checkbox-label">History of Angioedema w/ ACEi?</label>
                    </div>
                     <div class="checkbox-container pt-6">
                        <input type="checkbox" id="severe_mr" name="severe_mr">
                        <label for="severe_mr" class="checkbox-label">Chronic Severe Functional MR?</label>
                    </div>
                     <div class="checkbox-container pt-6">
                        <input type="checkbox" id="recurrent_decomp" name="recurrent_decomp">
                        <label for="recurrent_decomp" class="checkbox-label">Recurrent Decompensation / Advanced HF?</label>
                    </div>
                 </div>
            </fieldset>

             <!-- Button Container Box -->
            <div class="button-container-box">
                <div class="flex justify-center space-x-4">
                    <button type="button" id="suggest-btn">Suggest Therapies</button>
                    <button type="reset" id="reset-btn">Reset Form</button>
                </div>
            </div>
            <!-- End Button Container Box -->

        </form>

        <div id="result" class="result-box" style="display: none;">

             <div>
                <p class="result-section-title">Foundational GDMT Pillars (Assume Initiated/Titrating)</p>
                <ul id="gdmt-pillars" class="result-list">
                   <!-- JS will populate -->
                </ul>
            </div>

             <div id="symptom-mgmt-section" style="display: none;">
                <p class="result-section-title">Symptom Management</p>
                <ul id="symptom-mgmt" class="result-list">
                   <!-- JS will populate -->
                </ul>
            </div>

            <div id="additional-meds-section" style="display: none;">
                <p class="result-section-title">Consider Adding / Specific Indications</p>
                <ul id="additional-meds" class="result-list">
                    <!-- JS will populate -->
                </ul>
            </div>

             <div id="device-therapy-section" style="display: none;">
                 <p class="result-section-title">Consider Device Therapy Evaluation</p>
                 <ul id="device-therapy" class="result-list">
                     <!-- JS will populate -->
                 </ul>
            </div>

            <div id="advanced-therapy-section" style="display: none;">
                 <p class="result-section-title">Consider Advanced Therapies / Procedures</p>
                 <ul id="advanced-therapy" class="result-list">
                      <!-- JS will populate -->
                 </ul>
            </div>

             <div>
                 <p class="result-section-title">Lifestyle & General Measures</p>
                 <ul id="lifestyle" class="result-list">
                     <li><strong>General Measures:</strong> Weight loss (if appropriate), smoking cessation, guideline-recommended vaccinations, exercise training program.</li>
                      <li><strong>Blood Pressure Control:</strong> Target guideline goals.</li>
                 </ul>
            </div>

             <div>
                 <p class="result-section-title">Medications Generally Contraindicated/Cautioned</p>
                 <ul id="contraindications" class="result-list">
                     <li><strong>NSAIDs:</strong> Avoid.</li>
                     <li><strong>TZDs (Thiazolidinediones):</strong> Avoid.</li>
                      <li><strong>Non-dihydropyridine Calcium Channel Blockers:</strong> Use with caution or avoid (Diltiazem, Verapamil).</li>
                       <li><strong>Cilostazol:</strong> Contraindicated.</li>
                 </ul>
            </div>


             <p class="disclaimer">
                <strong>Disclaimer:</strong> This tool provides suggestions based on common HFrEF guidelines and the inputs provided. It is intended for educational purposes ONLY and DOES NOT replace clinical judgment, patient-specific factors, contraindications, drug interactions, or tolerance. Always consult full, current clinical practice guidelines and manage patients individually. Optimal GDMT involves careful initiation and titration.
            </p>
        </div>
    </div>

    <script>
        const form = document.getElementById('hfref-form');
        const suggestBtn = document.getElementById('suggest-btn');
        const resetBtn = document.getElementById('reset-btn');
        const resultDiv = document.getElementById('result');

        // Output sections
        const gdmtPillarsList = document.getElementById('gdmt-pillars');
        const symptomMgmtSection = document.getElementById('symptom-mgmt-section');
        const symptomMgmtList = document.getElementById('symptom-mgmt');
        const additionalMedsSection = document.getElementById('additional-meds-section');
        const additionalMedsList = document.getElementById('additional-meds');
        const deviceTherapySection = document.getElementById('device-therapy-section');
        const deviceTherapyList = document.getElementById('device-therapy');
        const advancedTherapySection = document.getElementById('advanced-therapy-section');
        const advancedTherapyList = document.getElementById('advanced-therapy');


        function suggestTherapies() {
            // Clear previous results
            gdmtPillarsList.innerHTML = '';
            symptomMgmtList.innerHTML = '';
            additionalMedsList.innerHTML = '';
            deviceTherapyList.innerHTML = '';
            advancedTherapyList.innerHTML = '';
            symptomMgmtSection.style.display = 'none';
            additionalMedsSection.style.display = 'none';
            deviceTherapySection.style.display = 'none';
            advancedTherapySection.style.display = 'none';


            // Read input values
            const lvef = parseInt(form.lvef.value) || null;
            const nyhaClass = form.nyha_class.value;
            const heartRate = parseInt(form.heart_rate.value) || null;
            const qrsDuration = parseInt(form.qrs_duration.value) || null;
            const isSinus = form.sinus_rhythm.checked;
            const hasLbbb = form.lbbb.checked;
            const hasAfib = form.afib.checked;
            const isCongested = form.congestion.checked;
            const onMaxBB = form.on_max_bb.checked;
            const onOptimalGDMT = form.on_optimal_gdmt.checked;
            const isBlackRace = form.black_race.checked;
            const isIronDeficient = form.iron_deficiency.checked;
            const hasT2DM = form.diabetes_t2dm.checked;
            const hasCKD = form.ckd.checked;
            const hasAngioedemaHx = form.angioedema_acei.checked;
            const hasSevereMR = form.severe_mr.checked;
            const isRecurrentDecomp = form.recurrent_decomp.checked;

            let showAdditional = false;
            let showDevice = false;
            let showAdvanced = false;
            let showSymptom = false;

            // --- 1. Foundational GDMT Pillars ---
            let gdmtHtml = '';

            // ARNI / ACEi / ARB
            if (hasAngioedemaHx) {
                gdmtHtml += `<li><strong>ARNI (Sacubitril/Valsartan):</strong> <span class="caveat">CONTRAINDICATED (Angioedema Hx).</span></li>`;
                gdmtHtml += `<li><strong>ACEi/ARB:</strong> <span class="caveat">CONTRAINDICATED (Angioedema Hx with ACEi applies to ARNI too).</span> Consider Hydralazine/Nitrate.</li>`;
            } else {
                gdmtHtml += `<li><strong>ARNI (Sacubitril/Valsartan):</strong> Preferred over ACEi/ARB for NYHA II-IV. <span class="note">C/I: Angioedema Hx, Pregnancy. Caution: Hypotension, Hyperkalemia, Renal Impairment, Bilateral Renal Artery Stenosis.</span></li>`;
                gdmtHtml += `<li><strong>ACEi/ARB:</strong> Alternative if ARNI intolerant. <span class="note">C/I: Angioedema Hx, Pregnancy. Caution: Hypotension, Hyperkalemia, Renal Impairment, Bilateral Renal Artery Stenosis.</span></li>`;
            }

            // Beta-Blocker
            gdmtHtml += `<li><strong>Beta-Blocker (Evidence-based: Metoprolol Succinate, Carvedilol, Bisoprolol):</strong> <span class="note">C/I: Severe Bradycardia, High-Degree AV Block (without pacemaker). Caution: Acute Decompensation (Avoid *initiating* or *up-titrating* acutely, continue if stable & tolerated), Reactive Airway Disease (use cardioselective), Hypotension.</span></li>`;

            // MRA
            gdmtHtml += `<li><strong>MRA (Spironolactone/Eplerenone):</strong> Indicated for NYHA II-IV (or post-MI EF≤40%+HF/DM). <span class="note">C/I: Hyperkalemia (K+ >5.0 mEq/L), Severe Renal Impairment (e.g., eGFR < 30 mL/min), Anuria. Monitor K+ and Renal function.</span></li>`;

            // SGLT2 Inhibitor
            gdmtHtml += `<li><strong>SGLT2 Inhibitor (-gliflozin):</strong> Broad indication for HFrEF (NYHA II-IV). <span class="note">C/I: T1DM, History of DKA, Severe Renal Impairment (check specific agent's eGFR cutoff). Caution: Volume Depletion, Risk of Genitourinary Infections.</span>`;
            if(hasT2DM) gdmtHtml += ` <span class="note">Also benefits ASCVD risk & T2DM control. GLP-1 Agonist (-glutide) alternative for T2DM/Weight loss but less direct HF benefit proven vs SGLT2i.</span>`;
            gdmtHtml += `</li>`;

            gdmtPillarsList.innerHTML = gdmtHtml;

             // --- 2. Symptom Management ---
            if (isCongested) {
                showSymptom = true;
                symptomMgmtList.innerHTML += `<li><strong>Diuretics (Loop):</strong> For congestion relief (PO or IV). <span class="note">Adjust dose based on volume status. IV dose often 1-2.5x home PO dose if admitted. Monitor electrolytes & renal function.</span></li>`;
            }

             // --- 3. Additional Medications ---
             if (onMaxBB && isSinus && heartRate && heartRate > 70 && lvef && lvef < 35) {
                 showAdditional = true;
                 additionalMedsList.innerHTML += `<li><strong>Ivabradine:</strong> Consider to lower HR if meeting criteria (On max BB, Sinus, HR>70, EF<35%).</li>`;
             }
             if (isIronDeficient) {
                  showAdditional = true;
                  additionalMedsList.innerHTML += `<li><strong>IV Iron (Ferric Carboxymaltose):</strong> Consider for iron deficiency (Ferritin <100 ng/mL or Ferritin 100-299 ng/mL with TSAT <20%).</li>`; // Updated criteria detail
             }
             // Corrected logic slightly - added check for NYHA class as per text
             if ((isBlackRace && (nyhaClass === 'III' || nyhaClass === 'IV')) || ((nyhaClass === 'III' || nyhaClass === 'IV') && !hasAngioedemaHx /* Implies intolerance/maxed on ARNI/ACEi/ARB could be reason */)) {
                  showAdditional = true;
                  additionalMedsList.innerHTML += `<li><strong>Hydralazine + Isosorbide Dinitrate (Hy/ISDN):</strong> Consider if Black NYHA III-IV on GDMT, OR persistent NYHA III-IV symptoms despite optimal ARNI/ACEi/ARB/BB/MRA/SGLT2i (especially if intolerant to ARNI/ACEi/ARB).</li>`;
             }
            if (hasAfib) {
                showAdditional = true;
                 additionalMedsList.innerHTML += `<li><strong>Anticoagulation:</strong> Assess need based on stroke risk (e.g., CHA2DS2-VASc).</li>`;
                 additionalMedsList.innerHTML += `<li><strong>Rate Control:</strong> Beta-blocker is first-line (if tolerated). <span class="note">Digoxin may be adjunct if needed, careful monitoring required. Avoid non-dihydropyridine CCBs.</span></li>`;
                 additionalMedsList.innerHTML += `<li><strong>Rhythm Control:</strong> Consider PVI referral based on symptoms/patient preference after discussing risks/benefits.</li>`;
            }
            // Last resort digitalis
            if (isRecurrentDecomp || (isCongested && (nyhaClass === 'III' || nyhaClass === 'IV'))) { // Triggered by advanced HF or persistent symptoms
                 if (!additionalMedsList.innerHTML.includes('Digoxin')) { // Check if NOT already added via AFib note
                     showAdditional = true;
                     additionalMedsList.innerHTML += `<li><strong>Digitalis (Digoxin):</strong> Consider for reducing hospitalizations in patients with persistent symptoms (NYHA II-IV) despite optimal GDMT. <span class="caveat">Narrow therapeutic window, monitor levels/toxicity, no mortality benefit, avoid if significant AV block.</span></li>`;
                 }
            }


            // --- 4. Device Therapy ---
             if (onOptimalGDMT && lvef) {
                // Primary Prevention ICD - Added ischemic/non-ischemic check based on timing notes
                let icdNote = "Specific timing applies post-MI (>40d) or revascularization (>3mo). Ensure etiology assessed & reversible causes excluded.";
                if ((lvef <= 35 && (nyhaClass === 'II' || nyhaClass === 'III')) || (lvef <= 30 && nyhaClass === 'I')) {
                     showDevice = true;
                     deviceTherapyList.innerHTML += `<li><strong>ICD Evaluation (Primary Prevention):</strong> Consider if LVEF ≤30% (NYHA I) or LVEF ≤35% (NYHA II-III) despite ≥3 months optimal GDMT, AND reasonable expectation of survival >1 year. <span class="note">${icdNote}</span></li>`;
                }
                 // CRT
                if (isSinus && hasLbbb && qrsDuration && lvef <= 35 && (nyhaClass === 'II' || nyhaClass === 'III' || nyhaClass === 'IV ambulatory')) { // Added ambulatory IV
                     if (qrsDuration >= 150) {
                          showDevice = true;
                          deviceTherapyList.innerHTML += `<li><strong>CRT Evaluation:</strong> Strong indication (LBBB, QRS ≥ 150ms). <span class="note">Improves symptoms, QOL, and survival.</span></li>`;
                     } else if (qrsDuration >= 130) { // Changed threshold based on flowchart
                           showDevice = true;
                          deviceTherapyList.innerHTML += `<li><strong>CRT Evaluation:</strong> Consider (LBBB, QRS 130-149ms). <span class="note">Benefit primarily functional capacity/symptoms, less mortality benefit vs QRS≥150.</span></li>`;
                     }
                 } else if (isSinus && !hasLbbb && qrsDuration && qrsDuration >=150 && lvef <=35 && (nyhaClass === 'III' || nyhaClass === 'IV ambulatory') ) {
                     // CRT for Non-LBBB - less common indication
                     showDevice = true;
                     deviceTherapyList.innerHTML += `<li><strong>CRT Evaluation (Non-LBBB):</strong> May be considered selectively if QRS ≥150ms, NYHA III/IV ambulatory. <span class="note">Benefit less certain than with LBBB.</span></li>`;
                 } else if (hasAfib && lvef <= 35 && (nyhaClass === 'III' || nyhaClass === 'IV ambulatory') && /* expecting AV node ablation or biventricular pacing */ true ) {
                    // CRT in AFib - more complex indication
                    // showDevice = true;
                    // deviceTherapyList.innerHTML += `<li><strong>CRT Evaluation (in AFib):</strong> Consider if patient is expected to be biventricularly paced nearly 100% (may require AV node ablation). Indications complex.</li>`;
                 }

             }
             // Secondary Prevention ICD (simplified input - assumes user knows if prior SCD/sustained VT occurred)
             // You could add a checkbox: "History of Resuscitated Cardiac Arrest / Sustained VT?"
             // if (historyOfSCD_VT) {
             //    showDevice = true;
             //    deviceTherapyList.innerHTML += `<li><strong>ICD Evaluation (Secondary Prevention):</strong> Indicated if reasonable expectation of survival >1 year.</li>`;
             // }

             // --- 5. Advanced Therapies / Procedures ---
              if (isRecurrentDecomp && (nyhaClass === 'III' || nyhaClass === 'IV')) { // Tied more strongly to advanced symptoms
                  showAdvanced = true;
                  advancedTherapyList.innerHTML += `<li><strong>Advanced HF Therapies:</strong> Consider Vericiguat or Omecamtiv Mecarbil referral/consultation.</li>`;
                  advancedTherapyList.innerHTML += `<li><strong>LVAD / Heart Transplant Evaluation:</strong> Refer eligible candidates with refractory Stage D HF.</li>`;
              }
               if (hasSevereMR && onOptimalGDMT && (nyhaClass === 'II' || nyhaClass === 'III' || nyhaClass === 'IV ambulatory')) { // Ensure symptomatic despite GDMT
                    showAdvanced = true;
                    advancedTherapyList.innerHTML += `<li><strong>Mitral TEER (Transcatheter Edge-to-Edge Repair):</strong> Consider evaluation for severe secondary MR persistent despite optimal GDMT if anatomy suitable and patient meets trial criteria.</li>`;
               }
                // BAT/CCM - From flowchart, often advanced HF, narrow QRS
                if (qrsDuration && qrsDuration < 120 && isRecurrentDecomp && (nyhaClass === 'III')) { // Example restrictive criteria
                    showAdvanced = true;
                    advancedTherapyList.innerHTML += `<li><strong>Consider Referral for Novel Therapies:</strong> Options like BAT/CCM may be considered in specialized centers for select patients with advanced HF and narrow QRS not eligible for CRT.</li>`;
                }


            // Show/hide sections based on whether content was added
            if (showSymptom) symptomMgmtSection.style.display = 'block';
            if (showAdditional) additionalMedsSection.style.display = 'block';
            if (showDevice) deviceTherapySection.style.display = 'block';
            if (showAdvanced) advancedTherapySection.style.display = 'block';

            resultDiv.style.display = 'block';
            resultDiv.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }

        function resetForm() {
            form.reset();
            form.sinus_rhythm.checked = true; // Ensure default is checked on reset
            resultDiv.style.display = 'none';
             gdmtPillarsList.innerHTML = '';
            symptomMgmtList.innerHTML = '';
            additionalMedsList.innerHTML = '';
            deviceTherapyList.innerHTML = '';
            advancedTherapyList.innerHTML = '';
            symptomMgmtSection.style.display = 'none';
            additionalMedsSection.style.display = 'none';
            deviceTherapySection.style.display = 'none';
            advancedTherapySection.style.display = 'none';
            try {
                form.scrollIntoView({ behavior: 'smooth', block: 'start' });
            } catch (e) { /* ignore */ }
        }

        suggestBtn.addEventListener('click', suggestTherapies);
        resetBtn.addEventListener('click', resetForm);
        form.addEventListener('change', () => { // Hide result if form changes
            if (resultDiv.style.display !== 'none') resultDiv.style.display = 'none';
        });

        resetForm(); // Initialize form state on load

    </script>

</body>
</html>
