<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HFrEF GDMT Selection Helper</title>
    <style>
        body {
            font-family: sans-serif;
            line-height: 1.6;
            max-width: 800px;
            margin: 20px auto;
            padding: 15px;
            border: 1px solid #ccc;
            border-radius: 8px;
        }
        h1, h2, h3 {
            color: #333;
            border-bottom: 1px solid #eee;
            padding-bottom: 5px;
        }
        h2 { margin-top: 30px; }
        h3 { margin-top: 20px; color: #555; }
        form label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        form input[type="number"], form select {
            width: 100%;
            padding: 8px;
            margin-bottom: 15px;
            border: 1px solid #ccc;
            border-radius: 4px;
            box-sizing: border-box; /* Prevents padding from increasing width */
        }
        form input[type="number"]::placeholder {
            color: #aaa;
        }
        form button {
            background-color: #007bff;
            color: white;
            padding: 10px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 1em;
        }
        form button:hover {
            background-color: #0056b3;
        }
        #results {
            margin-top: 30px;
            background-color: #f9f9f9;
            padding: 15px;
            border-radius: 4px;
        }
        .result-item {
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px dotted #ddd;
        }
        .result-item strong {
            color: #0056b3;
        }
        .indication { color: #28a745; } /* Green */
        .contraindication { color: #dc3545; } /* Red */
        .disclaimer {
            margin-top: 20px;
            font-style: italic;
            color: #dc3545;
            font-weight: bold;
            text-align: center;
            border: 1px solid #dc3545;
            padding: 10px;
            background-color: #f8d7da;
            border-radius: 4px;
        }
    </style>
</head>
<body>

    <h1>HFrEF GDMT Selection Helper</h1>
    <p>Enter patient details to see potentially relevant Guideline-Directed Medical Therapies based on simplified criteria.</p>

    <form id="gdmtForm">
        <label for="age">Age:</label>
        <input type="number" id="age" name="age" required>

        <label for="lvef">LVEF (%):</label>
        <input type="number" id="lvef" name="lvef" placeholder="e.g., 35" required>

        <label for="nyha">NYHA Class:</label>
        <select id="nyha" name="nyha" required>
            <option value="">Select NYHA Class</option>
            <option value="1">I (Asymptomatic)</option>
            <option value="2">II (Slight limitation)</option>
            <option value="3">III (Marked limitation)</option>
            <option value="4">IV (Symptoms at rest)</option>
        </select>

        <label for="hr">Heart Rate (bpm):</label>
        <input type="number" id="hr" name="hr" placeholder="Optional, needed for Ivabradine">

        <label for="qrs">QRS Duration (ms):</label>
        <input type="number" id="qrs" name="qrs" placeholder="Optional, needed for CRT/devices">

        <button type="submit">Analyze GDMT Options</button>
    </form>

    <div id="results">
        <!-- Results will be displayed here -->
    </div>

    <div class="disclaimer">
        <strong>Disclaimer:</strong> This tool is for informational and educational purposes only. It is NOT a substitute for professional medical advice, diagnosis, or treatment. Always consult with a qualified healthcare provider for any medical conditions or treatment decisions. Therapy selection requires comprehensive clinical evaluation.
    </div>

    <script>
        // Helper function to check if a value is not a number or null/empty
        function isNaNOrNull(value) {
            // Check if empty string, null, or truly NaN after conversion attempt
            if (value === "" || value === null) return true;
            const num = parseInt(value); // Use parseInt as HR/QRS are usually integers
            return isNaN(num);
        }

        // --- GDMT Data ---
        const gdmtOptions = [
            // --- Foundational Pillars (Generally for HFrEF NYHA II-IV, LVEF <= 40%) ---
            {
                name: "ARNI (Sacubitril/Valsartan)",
                category: "Foundational",
                indicationRule: (inputs) => inputs.lvef <= 40 && inputs.nyha >= 2,
                indications: "Preferred first-line over ACEi/ARB for HFrEF NYHA II-IV. Can be started de novo or switched from ACEi/ARB.",
                contraindications: "History of angioedema (especially with ACEi), concurrent ACEi use (needs 36hr washout), pregnancy. Use with caution in severe renal impairment, hypotension. Cannot be used if prior angioedema to ACEi."
            },
            {
                name: "ACE Inhibitor (ACEi)",
                category: "Foundational",
                indicationRule: (inputs) => inputs.lvef <= 40 && inputs.nyha >= 2,
                indications: "Alternative if ARNI not tolerated or feasible. HFrEF NYHA II-IV.",
                contraindications: "History of angioedema, bilateral renal artery stenosis, pregnancy, hyperkalemia. Caution in renal impairment, hypotension. Preferred over ARNI in breastfeeding."
            },
            {
                name: "Angiotensin Receptor Blocker (ARB)",
                category: "Foundational",
                indicationRule: (inputs) => inputs.lvef <= 40 && inputs.nyha >= 2,
                indications: "Alternative if intolerant to ACEi (e.g., cough) and ARNI not feasible. HFrEF NYHA II-IV.",
                contraindications: "Pregnancy, bilateral renal artery stenosis, hyperkalemia. Caution in renal impairment, hypotension. Cannot be used if prior angioedema to ACEi/ARB for ARNI consideration."
            },
            {
                name: "Beta-Blocker (Evidence-based: Metoprolol Succinate, Carvedilol, Bisoprolol)",
                category: "Foundational",
                indicationRule: (inputs) => inputs.lvef <= 40, // Indicated for all HFrEF patients unless contraindicated
                indications: "All patients with HFrEF (LVEF ≤40%), regardless of NYHA class (start once stable/euvolemic). Shown to improve survival.",
                contraindications: "Acute decompensated HF (initiate cautiously once stable), severe bradycardia, high-degree AV block (without pacemaker), severe asthma/reactive airway disease (use cardioselective like Bisoprolol/Metoprolol cautiously). Titrate slowly."
            },
            {
                name: "Mineralocorticoid Receptor Antagonist (MRA - Spironolactone, Eplerenone)",
                category: "Foundational",
                indicationRule: (inputs) => inputs.lvef <= 35 && inputs.nyha >= 2, // Common threshold, some use <=40% post-MI w/ HF/DM
                indications: "HFrEF NYHA II-IV with LVEF ≤35%. Also post-MI with LVEF ≤40% and HF symptoms or diabetes. Monitor K+ and renal function closely.",
                contraindications: "Hyperkalemia (K+ > 5.0 mEq/L), severe renal impairment (e.g., eGFR < 30 mL/min/1.73m² - check specific drug), anuria, Addison's disease. Eplerenone is more selective (less gynecomastia)."
            },
             {
                name: "SGLT2 Inhibitor (-gliflozin, e.g., Dapagliflozin, Empagliflozin)",
                category: "Foundational",
                indicationRule: (inputs) => inputs.lvef <= 40, // Broadly indicated across NYHA classes for HFrEF benefit
                indications: "HFrEF (LVEF ≤40%) across NYHA classes (II-IV often studied) regardless of diabetes status. Reduces HF hospitalizations and CV death. Also provides renal protection.",
                contraindications: "Type 1 Diabetes, history of DKA, severe renal impairment (check specific eGFR cutoffs for initiation/continuation, though often used *for* CKD). Risk of genital mycotic infections, volume depletion. Monitor for DKA (can be euglycemic)."
            },
            // --- Symptom Management ---
            {
                name: "Diuretics (Loop: Furosemide, Bumetanide, Torsemide)",
                category: "Symptom Management",
                indicationRule: (inputs) => inputs.nyha >= 2, // Used for congestion symptoms
                indications: "Management of fluid retention (congestion) in symptomatic HF (NYHA II-IV). Dose adjusted based on symptoms and volume status. IV for acute decompensation.",
                contraindications: "Anuria. Caution in electrolyte imbalances (hypokalemia, hypomagnesemia), hypotension, severe renal impairment. Can cause ototoxicity at high doses/rapid infusion."
            },
            // --- Add-on Therapies for Specific Conditions ---
             {
                name: "Ivabradine",
                category: "Add-on",
                indicationRule: (inputs) => inputs.lvef <= 35 && !isNaNOrNull(inputs.hr) && inputs.hr >= 70 && inputs.nyha >= 2, // Requires HR input
                indications: "HFrEF (LVEF ≤35%) in Sinus Rhythm with resting HR ≥70 bpm despite maximally tolerated beta-blocker dose (or C/I to BB). NYHA II-III. Reduces HF hospitalizations.",
                contraindications: "Acute decompensated HF, BP <90/50, sick sinus syndrome, SA block, AV block (2nd/3rd degree unless paced), severe hepatic impairment, pacemaker dependence, concurrent strong CYP3A4 inhibitors. Risk of phosphenes, bradycardia."
            },
             {
                name: "Hydralazine + Isosorbide Dinitrate (Hy/ISDN)",
                category: "Add-on",
                indicationRule: (inputs) => inputs.lvef <= 40 && inputs.nyha >= 3, // Primarily NYHA III-IV
                indications: "Recommended in self-identified Black patients with NYHA Class III-IV HFrEF on optimal therapy (ARNI/ACEi/ARB, BB, MRA). Can also be used in non-Black patients intolerant to ACEi/ARB/ARNI or as add-on if persistently symptomatic despite optimal GDMT.",
                contraindications: "Hypersensitivity. Hydralazine: Caution in CAD (can cause reflex tachycardia), lupus-like syndrome. ISDN: Concurrent PDE5 inhibitors (e.g., sildenafil), severe anemia, increased ICP. Both can cause headache, dizziness, hypotension."
            },
             {
                name: "Digoxin",
                category: "Add-on",
                indicationRule: (inputs) => inputs.lvef <= 40 && inputs.nyha >= 2, // For persistent symptoms
                indications: "May be considered to reduce HF hospitalizations in patients with HFrEF (LVEF ≤40%) who remain symptomatic (NYHA II-IV) despite optimal foundational GDMT. Can also be used for rate control in AFib (less common now). No mortality benefit.",
                contraindications: "Ventricular fibrillation, high-degree AV block (unless paced). Narrow therapeutic window - monitor levels. Risk of toxicity increased by hypokalemia, hypomagnesemia, renal impairment. Many drug interactions."
            },
             {
                name: "Iron (IV Ferric Carboxymaltose)",
                category: "Add-on",
                indicationRule: (inputs) => inputs.lvef <= 45 && inputs.nyha >= 2, // Based on trials, need lab confirmation
                indications: "Symptomatic HFrEF (LVEF ≤45%) and Iron Deficiency (Ferritin <100 ng/mL, OR Ferritin 100-299 ng/mL with TSAT <20%). Improves symptoms, functional capacity, QOL. Requires lab confirmation (not asked in form).",
                contraindications: "Known hypersensitivity, iron overload. Monitor for hypersensitivity reactions during/after infusion."
            },
             {
                name: "Vericiguat",
                category: "Add-on",
                indicationRule: (inputs) => inputs.lvef < 45 && inputs.nyha >= 2, // For worsening HF despite GDMT
                indications: "Soluble guanylate cyclase stimulator. To reduce risk of CV death and HF hospitalization following a recent worsening HF event (hospitalization or need for outpatient IV diuretics) in symptomatic chronic HFrEF (LVEF <45%) on GDMT.",
                contraindications: "Concurrent use of other sGC stimulators (e.g., riociguat) or PDE5 inhibitors. Pregnancy. Caution with hypotension."
            },
             // --- Devices ---
            {
                name: "Implantable Cardioverter-Defibrillator (ICD)",
                category: "Device",
                indicationRule: (inputs) => inputs.lvef <= 35 && inputs.nyha >= 1 && inputs.nyha <= 3, // Primary prevention criteria focus
                indications: "Primary Prevention: LVEF ≤35% due to prior MI (at least 40 days post-MI) or non-ischemic CM (at least 3 months on optimal GDMT), and NYHA Class II-III. OR LVEF ≤30% NYHA Class I (post-MI or NICM). Expected meaningful survival >1 year. Secondary Prevention: Survivors of cardiac arrest due to VT/VF, or spontaneous sustained VT.",
                contraindications: "Terminal illness with life expectancy <1 year, incessant VT/VF, significant psychiatric illness. Procedure risks (infection, lead issues, inappropriate shocks)."
            },
            {
                name: "Cardiac Resynchronization Therapy (CRT / CRT-D)",
                category: "Device",
                indicationRule: (inputs) => inputs.lvef <= 35 && inputs.nyha >= 2 && inputs.nyha <= 4 && !isNaNOrNull(inputs.qrs) && inputs.qrs >= 130, // Simplified QRS, needs LBBB ideally
                indications: "LVEF ≤35%, Sinus Rhythm, NYHA Class II, III, or ambulatory IV, on optimal GDMT. Strongest indication with LBBB morphology and QRS ≥150 ms. Consider for LBBB QRS 130-149 ms, or non-LBBB QRS ≥150 ms. Improves symptoms, functional capacity, and survival (CRT-D combines CRT + ICD).",
                contraindications: "Life expectancy <1 year. Anatomic limitations to lead placement. Patient preference."
            },
             // --- Advanced Therapies / Specific Situations ---
            {
                name: "Mitral Transcatheter Edge-to-Edge Repair (TEER)",
                category: "Advanced",
                indicationRule: (inputs) => inputs.lvef >= 20 && inputs.lvef <= 50 && inputs.nyha >= 2, // Broad criteria, needs echo confirmation
                indications: "Selected patients with chronic moderate-to-severe or severe secondary (functional) Mitral Regurgitation (MR) who remain symptomatic (NYHA II-IV) despite optimal GDMT, and have suitable valve anatomy. Requires heart team evaluation.",
                contraindications: "Unsuitable anatomy, severe LV dysfunction prohibitive for procedure, life expectancy <1 year."
            },
            {
                name: "LVAD / Heart Transplant Referral",
                category: "Advanced",
                indicationRule: (inputs) => inputs.lvef <= 35 && inputs.nyha >= 3, // Generally advanced HF
                indications: "Patients with advanced, refractory HFrEF (Stage D) despite optimal medical/device therapy. Consider for NYHA III-IV symptoms, recurrent hospitalizations, end-organ dysfunction due to hypoperfusion, low cardiac output, high filling pressures. Needs evaluation at specialized center.",
                contraindications: "Significant comorbidities precluding surgery (severe irreversible PHTN, active malignancy, severe renal/hepatic disease, psychosocial issues, non-adherence)."
            },
            // --- General & Avoid ---
            {
                name: "Lifestyle & General Measures",
                category: "General",
                indicationRule: () => true, // Always relevant
                indications: "Sodium restriction (controversial, but generally avoid excess), fluid restriction (if hyponatremic/congested), regular exercise/cardiac rehab, weight management, smoking cessation, influenza/pneumococcal vaccination, manage comorbidities (HTN, DM, Afib, Sleep Apnea).",
                contraindications: "N/A"
            },
             {
                name: "Medications to AVOID",
                category: "Avoid",
                indicationRule: () => true, // Always relevant
                indications: "NSAIDs (inc. COX-2 inhibitors - cause Na/water retention, worsen HF), TZDs (Thiazolidinediones like pioglitazone - fluid retention), most non-dihydropyridine CCBs (Verapamil, Diltiazem - negative inotropes, worsen outcomes in HFrEF), Cilostazol, potentially some antiarrhythmics (Class I, Dronedarone).",
                contraindications: "N/A (These are the contraindications themselves)"
            }
        ];

        // --- Form Submission Logic ---
        document.getElementById('gdmtForm').addEventListener('submit', function(event) {
            event.preventDefault(); // Prevent page reload

            const inputs = {
                age: parseInt(document.getElementById('age').value),
                lvef: parseInt(document.getElementById('lvef').value),
                nyha: parseInt(document.getElementById('nyha').value),
                hr: parseInt(document.getElementById('hr').value), // Will be NaN if empty
                qrs: parseInt(document.getElementById('qrs').value) // Will be NaN if empty
            };

            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = '<h2>Potential GDMT Options:</h2>'; // Clear previous results and add title

            // Check for HFpEF - very basic mention
            if (inputs.lvef >= 50) {
                 resultsDiv.innerHTML += `<p><strong>Note:</strong> LVEF ≥ 50% suggests Heart Failure with Preserved Ejection Fraction (HFpEF). Management focuses on treating underlying causes (HTN, AFib, Obesity), managing congestion (diuretics), and considering SGLT2i and potentially MRAs based on recent trials. Detailed HFpEF management is beyond this tool's primary scope.</p>`;
                 // Optionally, could add specific HFpEF rules here based on the text.
            }


            // Group results by category
            const categories = {
                "Foundational": [],
                "Symptom Management": [],
                "Add-on": [],
                "Device": [],
                "Advanced": [],
                "General": [],
                "Avoid": []
            };

            gdmtOptions.forEach(option => {
                // Check if the basic rule applies OR if it's a general/avoid category
                 if (option.indicationRule(inputs) || ['General', 'Avoid'].includes(option.category)) {
                    // Special check for optional inputs required by the rule
                    let meetsOptionalCriteria = true;
                    if (option.name === "Ivabradine" && isNaNOrNull(inputs.hr)) {
                         meetsOptionalCriteria = false; // Skip if HR needed but not provided
                         option.indications += " <strong>(Requires Heart Rate input)</strong>";
                    }
                    if (option.name === "Cardiac Resynchronization Therapy (CRT / CRT-D)" && isNaNOrNull(inputs.qrs)) {
                         meetsOptionalCriteria = false; // Skip if QRS needed but not provided
                         option.indications += " <strong>(Requires QRS Duration input)</strong>";
                    }
                     // Add specific check for LVEF < 40% for most HFrEF therapies if not already covered by rule
                    if (!['General', 'Avoid'].includes(option.category) && inputs.lvef >= 40 && option.name !== 'Iron (IV Ferric Carboxymaltose)' && option.name !== 'Vericiguat' && option.name !== "Mitral Transcatheter Edge-to-Edge Repair (TEER)") {
                         // Add exceptions like Iron, Vericiguat, TEER which may have slightly higher EF cutoffs in some trials/indications
                         if (inputs.lvef < 50) { // Handle mildly reduced EF case minimally
                             // Allow therapies potentially considered in HFmrEF or specific higher EF cutoffs
                         } else {
                            meetsOptionalCriteria = false; // Skip most HFrEF drugs if EF is normal/preserved
                         }
                    }


                    if (meetsOptionalCriteria) {
                        categories[option.category].push(`
                            <div class="result-item">
                                <h3>${option.name}</h3>
                                <p><strong class="indication">Indications:</strong> ${option.indications}</p>
                                <p><strong class="contraindication">Contraindications/Cautions:</strong> ${option.contraindications}</p>
                            </div>
                        `);
                    } else if (['General', 'Avoid'].includes(option.category)) {
                         // Always show General/Avoid categories
                         categories[option.category].push(`
                            <div class="result-item">
                                <h3>${option.name}</h3>
                                <p><strong class="indication">Details:</strong> ${option.indications}</p>
                            </div>
                        `);
                    }

                 }
            });

            // Display grouped results
            for (const category in categories) {
                if (categories[category].length > 0) {
                    resultsDiv.innerHTML += `<h2>${category.replace(/([A-Z])/g, ' $1').trim()} Therapies</h2>`; // Add spaces before caps
                    resultsDiv.innerHTML += categories[category].join('');
                }
            }

             if (resultsDiv.innerHTML === '<h2>Potential GDMT Options:</h2>') {
                 resultsDiv.innerHTML += '<p>No specific therapies matched the core criteria based on the inputs provided, or LVEF suggests HFpEF (see note above if applicable). Ensure foundational GDMT principles and lifestyle measures are considered. Consult guidelines for detailed criteria.</p>';
            }
        });
    </script>

</body>
</html>
