<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hepatitis B Serology Interpreter</title>
    <script src="https://cdn.tailwindcss.com"></script> {/* Make sure this loads */}
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* Apply Inter font globally */
        body {
            font-family: 'Inter', sans-serif;
            /* @apply bg-slate-100; <-- REMOVED FROM HERE */
        }

        /* Custom styles for select dropdown arrow using Tailwind */
        select {
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e");
            background-position: right 0.5rem center;
            background-repeat: no-repeat;
            background-size: 1.5em 1.5em;
            padding-right: 2.5rem;
            appearance: none; /* Remove default styling */
            -webkit-appearance: none; /* For Safari */
            -moz-appearance: none; /* For Firefox */
        }
    </style>
</head>
<body class="p-4 md:p-8"> {/* Body padding and background */}

    <div class="max-w-4xl mx-auto bg-gradient-to-b from-white to-slate-50 p-6 md:p-8 rounded-xl shadow-xl border border-slate-200"> {/* Main container styling */}
        <h1 class="text-3xl font-bold text-slate-800 mb-2 text-center">Hepatitis B Serology Interpreter</h1> {/* Main title */}
        <p class="text-base text-slate-600 mb-8 text-center">Enter the results of Hepatitis B serological markers to get a likely interpretation based on common patterns.</p> {/* Subtitle */}

        <form id="hbv-form" class="space-y-6"> {/* Form with vertical spacing */}

            <fieldset class="border border-slate-200 p-5 rounded-lg shadow-sm bg-white"> {/* Fieldset styling */}
                <legend class="text-lg font-semibold text-slate-800 px-2 -ml-2">Core Serological Markers</legend> {/* Legend styling */}
                <div class="grid grid-cols-1 md:grid-cols-2 gap-x-6 gap-y-5 mt-3">  {/* Grid layout for inputs */}
                    <div> {/* Input group */}
                        <label for="hbsag" class="block text-sm font-medium text-slate-700 mb-1">HBsAg (Surface Antigen):</label> {/* Label styling */}
                        <select id="hbsag" name="hbsag" class="mt-1 block w-full rounded-md border-slate-300 shadow-sm focus:border-blue-500 focus:ring focus:ring-blue-500 focus:ring-opacity-50 sm:text-sm p-2.5 bg-white text-slate-900"> {/* Select styling */}
                            <option value="na">N/A</option>
                            <option value="Negative">Negative</option>
                            <option value="Positive">Positive</option>
                        </select>
                    </div>
                    <div> {/* Input group */}
                        <label for="anti_hbs" class="block text-sm font-medium text-slate-700 mb-1">Anti-HBs (Surface Antibody):</label>
                        <select id="anti_hbs" name="anti_hbs" class="mt-1 block w-full rounded-md border-slate-300 shadow-sm focus:border-blue-500 focus:ring focus:ring-blue-500 focus:ring-opacity-50 sm:text-sm p-2.5 bg-white text-slate-900">
                            <option value="na">N/A</option>
                            <option value="<10">< 10 IU/L</option>
                            <option value=">=10">≥ 10 IU/L</option>
                        </select>
                    </div>
                    <div> {/* Input group */}
                        <label for="anti_hbc_total" class="block text-sm font-medium text-slate-700 mb-1">Anti-HBc Total (Core Antibody):</label>
                        <select id="anti_hbc_total" name="anti_hbc_total" class="mt-1 block w-full rounded-md border-slate-300 shadow-sm focus:border-blue-500 focus:ring focus:ring-blue-500 focus:ring-opacity-50 sm:text-sm p-2.5 bg-white text-slate-900">
                            <option value="na">N/A</option>
                            <option value="Negative">Negative</option>
                            <option value="Positive">Positive</option>
                        </select>
                    </div>
                     <div> {/* Input group */}
                        <label for="anti_hbc_igm" class="block text-sm font-medium text-slate-700 mb-1">Anti-HBc IgM (IgM Core Antibody):</label>
                        <select id="anti_hbc_igm" name="anti_hbc_igm" class="mt-1 block w-full rounded-md border-slate-300 shadow-sm focus:border-blue-500 focus:ring focus:ring-blue-500 focus:ring-opacity-50 sm:text-sm p-2.5 bg-white text-slate-900">
                            <option value="na">N/A</option>
                            <option value="Negative">Negative</option>
                            <option value="Positive">Positive</option>
                        </select>
                    </div>
                </div>
            </fieldset>

             <fieldset class="border border-slate-200 p-5 rounded-lg shadow-sm bg-white"> {/* Fieldset styling */}
                <legend class="text-lg font-semibold text-slate-800 px-2 -ml-2">Additional Markers (for Phasing/Staging)</legend> {/* Legend styling */}
                <div class="grid grid-cols-1 md:grid-cols-2 gap-x-6 gap-y-5 mt-3"> {/* Grid layout for inputs */}
                     <div> {/* Input group */}
                        <label for="hbeag" class="block text-sm font-medium text-slate-700 mb-1">HBeAg (e Antigen):</label>
                        <select id="hbeag" name="hbeag" class="mt-1 block w-full rounded-md border-slate-300 shadow-sm focus:border-blue-500 focus:ring focus:ring-blue-500 focus:ring-opacity-50 sm:text-sm p-2.5 bg-white text-slate-900">
                            <option value="na">N/A</option>
                            <option value="Negative">Negative</option>
                            <option value="Positive">Positive</option>
                        </select>
                    </div>
                     <div> {/* Input group */}
                        <label for="anti_hbe" class="block text-sm font-medium text-slate-700 mb-1">Anti-HBe (e Antibody):</label>
                        <select id="anti_hbe" name="anti_hbe" class="mt-1 block w-full rounded-md border-slate-300 shadow-sm focus:border-blue-500 focus:ring focus:ring-blue-500 focus:ring-opacity-50 sm:text-sm p-2.5 bg-white text-slate-900">
                            <option value="na">N/A</option>
                            <option value="Negative">Negative</option>
                            <option value="Positive">Positive</option>
                        </select>
                    </div>
                    <div> {/* Input group */}
                        <label for="hbv_dna" class="block text-sm font-medium text-slate-700 mb-1">HBV DNA Level:</label>
                        <select id="hbv_dna" name="hbv_dna" class="mt-1 block w-full rounded-md border-slate-300 shadow-sm focus:border-blue-500 focus:ring focus:ring-blue-500 focus:ring-opacity-50 sm:text-sm p-2.5 bg-white text-slate-900">
                            <option value="na">N/A</option>
                            <option value="Undetectable">Undetectable</option>
                            <option value="Low (<2000 IU/mL)">Low (<2000 IU/mL)</option>
                            <option value="Mod (2000-20k IU/mL)">Moderate (2k-20k IU/mL)</option>
                            <option value="High (>=20k IU/mL)">High (≥20k IU/mL)</option>
                        </select>
                    </div>
                     <div> {/* Input group */}
                        <label for="alt" class="block text-sm font-medium text-slate-700 mb-1">ALT Level:</label>
                        <select id="alt" name="alt" class="mt-1 block w-full rounded-md border-slate-300 shadow-sm focus:border-blue-500 focus:ring focus:ring-blue-500 focus:ring-opacity-50 sm:text-sm p-2.5 bg-white text-slate-900">
                            <option value="na">N/A</option>
                            <option value="Normal">Normal</option>
                            <option value="Elevated">Elevated</option>
                            <option value="Slightly Elevated">Slightly Elevated</option> {/* Added this option based on JS logic */}
                        </select>
                    </div>
                </div>
            </fieldset>

             {/* Button Container Box */}
            <div class="mt-8 pt-6 pb-4 px-4 bg-slate-50 border border-slate-200 rounded-lg shadow-sm"> {/* Button container styling */}
                <div class="flex justify-center space-x-4">
                    <button type="button" id="interpret-btn" class="px-6 py-2.5 text-sm font-medium rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-offset-2 transition duration-150 ease-in-out disabled:opacity-60 disabled:cursor-not-allowed bg-blue-600 text-white hover:bg-blue-700 focus:ring-blue-500"> {/* Interpret button styling */}
                        Interpret Results
                    </button>
                    <button type="reset" id="reset-btn" class="px-6 py-2.5 text-sm font-medium rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-offset-2 transition duration-150 ease-in-out disabled:opacity-60 disabled:cursor-not-allowed bg-slate-200 text-slate-800 hover:bg-slate-300 focus:ring-slate-400"> {/* Reset button styling */}
                        Reset Form
                    </button>
                </div>
            </div>
            {/* End Button Container Box */}

        </form>

        <div id="result" class="mt-8 p-6 bg-blue-50 border border-blue-300 rounded-lg shadow-md space-y-4" style="display: none;"> {/* Result box styling */}
            <div>
                <p class="text-sm font-medium text-blue-800 uppercase tracking-wider">Interpretation:</p> {/* Result section title styling */}
                <p id="interpretation" class="text-xl font-semibold text-blue-700"></p> {/* Result text styling */}
            </div>
            <div id="phase-stage-section" style="display: none;">
                 <p class="text-sm font-medium text-blue-800 uppercase tracking-wider">Likely Phase / Stage:</p> {/* Result section title styling */}
                 <p id="phase-stage" class="text-base font-medium text-blue-600"></p> {/* Result text styling */}
            </div>
             <div>
                 <p class="text-sm font-medium text-blue-800 uppercase tracking-wider">Recommendations / Notes:</p> {/* Result section title styling */}
                 <div id="recommendations" class="text-sm text-slate-700 leading-relaxed"> {/* Recommendations text styling */}
                    {/* Recommendations will be inserted here by JS */}
                 </div>
             </div>
             <p class="mt-5 text-xs text-slate-500 border-t border-slate-200 pt-3"> {/* Disclaimer styling */}
                <strong>Disclaimer:</strong> This tool provides interpretations based on common serological patterns. Results should always be interpreted in the full clinical context by a qualified healthcare professional. Atypical patterns or specific clinical situations may require expert consultation. This tool does not replace clinical judgment. Follow current AASLD/EASL or local guidelines.
            </p>
        </div>
    </div>

    <script>
        // Get references to form elements
        const form = document.getElementById('hbv-form');
        const hbsagSelect = document.getElementById('hbsag');
        const antiHbsSelect = document.getElementById('anti_hbs');
        const antiHbcTotalSelect = document.getElementById('anti_hbc_total');
        const antiHbcIgmSelect = document.getElementById('anti_hbc_igm');
        const hbeagSelect = document.getElementById('hbeag');
        const antiHbeSelect = document.getElementById('anti_hbe');
        const hbvDnaSelect = document.getElementById('hbv_dna');
        const altSelect = document.getElementById('alt');

        const interpretBtn = document.getElementById('interpret-btn');
        const resetBtn = document.getElementById('reset-btn');
        const resultDiv = document.getElementById('result');
        const interpretationDisplay = document.getElementById('interpretation');
        const phaseStageSection = document.getElementById('phase-stage-section');
        const phaseStageDisplay = document.getElementById('phase-stage');
        const recommendationsDisplay = document.getElementById('recommendations');

        // --- Interpretation Logic ---
        function interpretSerology() {
            // Read input values
            const hbsag = hbsagSelect.value;
            const antiHbs = antiHbsSelect.value;
            const antiHbcTotal = antiHbcTotalSelect.value;
            const antiHbcIgm = antiHbcIgmSelect.value;
            const hbeag = hbeagSelect.value;
            const antiHbe = antiHbeSelect.value;
            const hbvDna = hbvDnaSelect.value;
            const alt = altSelect.value;

            let interpretation = 'Unable to interpret clearly with provided data.';
            let phaseStage = '';
            // Use Tailwind classes for list styling within the recommendations
            let recommendations = ['<ul class="list-disc list-inside space-y-1"><li>Clinical correlation is always required.</li>'];

            // --- Core Logic based on HBsAg, Anti-HBc Total, Anti-HBs, Anti-HBc IgM ---

            // 1. Susceptible
            if (hbsag === 'Negative' && antiHbcTotal === 'Negative' && antiHbs === '<10') {
                interpretation = 'No HBV infection, Susceptible.';
                recommendations.push('<li>Consider Hepatitis B vaccination.</li>');
            }
            // 2. Immune - Vaccination
            else if (hbsag === 'Negative' && antiHbcTotal === 'Negative' && antiHbs === '>=10') {
                interpretation = 'Immune due to HBV vaccination.';
                recommendations.push('<li>No further action typically needed regarding HBV immunity.</li>');
            }
            // 3. Immune - Resolved Natural Infection
            else if (hbsag === 'Negative' && antiHbcTotal === 'Positive' && antiHbs === '>=10') {
                 interpretation = 'Immune due to past/resolved natural HBV infection.';
                 recommendations.push('<li>Low risk of reactivation, but consider if significant immunosuppression planned.</li>');
                 // Occult HBV check
                 if (hbvDna !== 'na' && hbvDna !== 'Undetectable') {
                    recommendations.push('<li>Note: Detectable HBV DNA with this pattern could indicate occult HBV - consult specialist if clinically relevant.</li>');
                 }
            }
             // 4. Isolated Anti-HBc Positive
            else if (hbsag === 'Negative' && antiHbcTotal === 'Positive' && antiHbs === '<10') {
                interpretation = 'Isolated Anti-HBc positive.';
                 recommendations.push('<li>Possible Interpretations:</li>');
                 // Nested list with styling
                 recommendations.push('<ul class="list-disc list-inside pl-4 space-y-1"><li>Resolved infection (waning Anti-HBs).</li><li>False-positive Anti-HBc.</li><li>Low-level chronic infection (HBsAg below detection).</li><li>Window period of acute infection (less likely if IgM negative).</li></ul>');
                 if (antiHbcIgm === 'Positive') {
                    recommendations.push('<li>Positive IgM suggests possible acute infection window period - retest HBsAg/IgM later.</li>');
                 } else {
                     recommendations.push('<li>Consider checking HBV DNA if immunosuppression planned or liver enzymes are elevated.</li>');
                 }
            }
             // --- Patterns involving Positive HBsAg ---
            else if (hbsag === 'Positive') {
                recommendations.push('<li>Positive HBsAg indicates HBV infection (acute or chronic).</li>');
                recommendations.push('<li>Initial positive HBsAg should ideally be confirmed with a neutralization assay or repeat testing.</li>');

                // 5. Acute HBV
                if (antiHbcTotal === 'Positive' && antiHbcIgm === 'Positive') {
                    interpretation = 'Acute Hepatitis B Infection.';
                    phaseStage = 'Early Phase (Typical)';
                    recommendations.push('<li>Monitor LFTs, symptoms, and serologies for resolution (loss of HBsAg, development of Anti-HBs).</li>');
                     recommendations.push('<li>Check HBeAg/Anti-HBe and HBV DNA for baseline.</li>');
                    recommendations.push('<li>Reportable condition in many regions.</li>');
                }
                // 6. Chronic HBV (or early infection if IgM status unclear/negative but clinically acute)
                else if (antiHbcTotal === 'Positive' && (antiHbcIgm === 'Negative' || antiHbcIgm === 'na')) {
                    interpretation = 'Chronic Hepatitis B Infection (or possibly resolving acute).';
                    recommendations.push('<li>Presence > 6 months confirms chronic infection.</li>');
                    recommendations.push('<li>Requires staging (assess liver fibrosis) and monitoring. Assess for treatment eligibility based on phase, DNA, ALT, and fibrosis.</li>');

                    // --- Sub-typing Chronic HBV ---
                    // Use || 'na' check for ALT/DNA as they might not always be available for initial phasing guess
                    if (hbeag === 'Positive' && (alt === 'Normal' || alt === 'Slightly Elevated' || alt === 'na') && (hbvDna === 'High (>=20k IU/mL)' || hbvDna === 'na')) {
                        phaseStage = 'Chronic HBV: Likely Immune-Tolerant Phase';
                        recommendations.push('<li>Suggests high DNA, normal/near-normal ALT, HBeAg positive. Monitor regularly (e.g., ALT/DNA every 6-12 months). Typically lower priority for immediate treatment unless advanced fibrosis present.</li>');
                    } else if (hbeag === 'Positive' && alt === 'Elevated' && (hbvDna === 'High (>=20k IU/mL)' || hbvDna === 'Mod (2000-20k IU/mL)' || hbvDna === 'na')) {
                        phaseStage = 'Chronic HBV: Likely Immune-Active Phase (HBeAg Positive)';
                        recommendations.push('<li>Suggests elevated ALT, high/moderate DNA, HBeAg positive. Higher priority for treatment assessment.</li>');
                    } else if (hbeag === 'Negative' && antiHbe === 'Positive' && alt === 'Elevated' && (hbvDna === 'Mod (2000-20k IU/mL)' || hbvDna === 'High (>=20k IU/mL)')) {
                         phaseStage = 'Chronic HBV: Likely Immune-Active Phase (HBeAg Negative)';
                         recommendations.push('<li>Suggests elevated ALT, moderate/high DNA (>2000 IU/mL typically), HBeAg negative, Anti-HBe positive. Assess for treatment.</li>');
                    } else if (hbeag === 'Negative' && (antiHbe === 'Positive' || antiHbe === 'na') && (alt === 'Normal' || alt === 'Slightly Elevated') && (hbvDna === 'Undetectable' || hbvDna === 'Low (<2000 IU/mL)')) {
                         phaseStage = 'Chronic HBV: Likely Inactive Carrier State';
                         recommendations.push('<li>Suggests normal/near-normal ALT, low/undetectable DNA, HBeAg negative. Monitor regularly (e.g. ALT every 6-12m, DNA periodically). Lower risk of progression if truly inactive.</li>');
                    } else if (hbeag === 'na' || antiHbe === 'na' || hbvDna === 'na' || alt === 'na') {
                         phaseStage = 'Chronic HBV: Phase Requires More Data';
                         recommendations.push('<li>Complete HBeAg/Anti-HBe, HBV DNA, and ALT needed to better determine the phase and need for treatment.</li>');
                    } else {
                         phaseStage = 'Chronic HBV: Pattern may represent transition or requires further evaluation.';
                         recommendations.push('<li>Clinical context, fibrosis assessment, and trends over time are important. Consult guidelines or specialist.</li>');
                    }
                }
                // 7. Atypical: HBsAg Positive, Anti-HBc Total Negative (Rare)
                else if (antiHbcTotal === 'Negative') {
                    interpretation = 'Atypical Pattern: HBsAg Positive, Anti-HBc Total Negative.';
                     recommendations.push('<li>Possible Causes:</li>');
                      recommendations.push('<ul class="list-disc list-inside pl-4 space-y-1"><li>Very early acute infection (pre-Anti-HBc).</li><li>Severe immunosuppression.</li><li>False-positive HBsAg.</li><li>Rarely after recent vaccination (transient HBsAg).</li></ul>');
                    recommendations.push('<li>Requires repeat testing and clinical correlation. Confirm HBsAg. Check Anti-HBc IgM.</li>');
                }
            }
            // 8. Handle other 'na' cases or unclear patterns
            else if (hbsag === 'na' || antiHbcTotal === 'na' || antiHbs === 'na') {
                 interpretation = 'Incomplete Data for Full Interpretation.';
                 recommendations.push('<li>Requires at least HBsAg, Anti-HBs, and Anti-HBc Total for baseline interpretation.</li>');
            }

             // Final check for recommendation list structure and ensure it's closed
            if (recommendations.length <= 1) { // Only the default item
                 recommendations = ['<ul class="list-disc list-inside space-y-1"><li>No specific recommendations generated based on this pattern, consult guidelines.</li></ul>'];
            } else {
                 recommendations.push('</ul>'); // Close the main UL if items were added
            }
            recommendationsDisplay.innerHTML = recommendations.join(''); // Join items


            // Display results
            interpretationDisplay.textContent = interpretation;
            if (phaseStage) {
                 phaseStageDisplay.textContent = phaseStage;
                 phaseStageSection.style.display = 'block';
            } else {
                 phaseStageSection.style.display = 'none';
            }

            resultDiv.style.display = 'block';
            // Scroll to results smoothly
             resultDiv.scrollIntoView({ behavior: 'smooth', block: 'nearest' }); // Use 'nearest' to avoid excessive scrolling if already visible
        }


        // --- Form Handling Logic ---
        function resetForm() {
            form.reset();
            resultDiv.style.display = 'none';
            interpretationDisplay.textContent = '';
            phaseStageDisplay.textContent = '';
            recommendationsDisplay.innerHTML = '';
            phaseStageSection.style.display = 'none';
            // Scroll back to top smoothly if not already there
             window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // --- Event Listeners ---
        interpretBtn.addEventListener('click', interpretSerology);
        resetBtn.addEventListener('click', resetForm);

         // Optional: Hide result if form changes after interpretation
        form.addEventListener('change', () => {
            if (resultDiv.style.display !== 'none') {
                 resultDiv.style.display = 'none';
            }
        });

        // --- Initial Setup ---
        // Don't reset on load, allow potential browser autofill
        // resetForm();

    </script>

</body>
</html>
