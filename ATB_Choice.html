<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Antibiotic Spectrum Guide</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* --- Basic Reset & Global Styles --- */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        body {
            font-family: 'Inter', sans-serif;
            line-height: 1.6;
            background-color: #f1f5f9; /* bg-slate-100 */
            color: #333;
            padding: 1rem; /* p-4 */
        }

        /* --- Main Container --- */
        .main-container {
            max-width: 1152px; /* max-w-6xl */
            margin: 20px auto;
            background: linear-gradient(to bottom, white, #f8fafc); /* bg-gradient-to-b from-white to-slate-50 */
            padding: 1.5rem; /* p-6 */
            border-radius: 12px; /* rounded-xl */
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04); /* shadow-xl approximation */
            border: 1px solid #e2e8f0; /* border border-slate-200 */
        }

        /* --- Title Styling --- */
        .main-title {
            font-size: 1.875rem; /* text-3xl */
            font-weight: 700; /* font-bold */
            color: #1e293b; /* text-slate-800 */
            margin-bottom: 0.5rem; /* mb-2 */
            text-align: center;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
        }
        .sub-title {
            font-size: 1rem; /* text-base */
            color: #475569; /* text-slate-600 */
            margin-bottom: 2rem; /* mb-8 */
            text-align: center;
        }

        /* --- Form Styling --- */
        fieldset {
            border: 1px solid #e2e8f0; /* border border-slate-200 */
            padding: 1.25rem; /* p-5 */
            border-radius: 8px; /* rounded-lg */
            box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05); /* shadow-sm */
            background-color: white; /* bg-white */
            margin-bottom: 1.5rem;
        }
        legend {
            font-size: 1.125rem; /* text-lg */
            font-weight: 600; /* font-semibold */
            color: #1e293b; /* text-slate-800 */
            padding: 0 0.5rem; /* px-2 */
            margin-left: -0.5rem; /* -ml-2 */
            margin-bottom: 1rem;
        }

        /* Mode Selection (Radio Buttons) */
        .mode-selection {
            display: flex;
            justify-content: center;
            gap: 1.5rem;
            margin-bottom: 1.5rem;
        }
        .mode-selection label {
            display: flex;
            align-items: center;
            cursor: pointer;
            font-size: 0.95em;
        }
         .mode-selection input[type="radio"] {
            margin-right: 0.5rem;
            accent-color: #2563eb; /* Make radio button blue */
         }

        /* Input Group & Select */
        .input-group {
             /* Wrapper for label + input/select */
             max-width: 512px; /* max-w-lg */
             margin-left: auto;
             margin-right: auto;
             margin-bottom: 1rem;
        }

        label.select-label {
            display: block;
            font-size: 0.875rem; /* text-sm */
            font-weight: 500; /* font-medium */
            color: #334155; /* text-slate-700 */
            margin-bottom: 0.25rem; /* mb-1 */
        }

        select {
            margin-top: 0.25rem; /* mt-1 */
            display: block;
            width: 100%;
            border-radius: 6px; /* rounded-md */
            border: 1px solid #cbd5e1; /* border-slate-300 */
            box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05); /* shadow-sm */
            padding: 0.625rem; /* p-2.5 */
            background-color: white; /* bg-white */
            color: #0f172a; /* text-slate-900 */
            font-size: 0.875rem; /* sm:text-sm */
            appearance: none;
            -webkit-appearance: none;
            -moz-appearance: none;
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e");
            background-position: right 0.5rem center;
            background-repeat: no-repeat;
            background-size: 1.5em 1.5em;
            padding-right: 2.5rem; /* Make space for arrow */
        }

        select:focus {
            border-color: #3b82f6; /* focus:border-blue-500 */
            outline: 2px solid transparent;
            outline-offset: 2px;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.5); /* focus:ring approximation */
        }

        /* --- Button Container & Buttons --- */
        .button-container-box {
            margin-top: 1.5rem; /* mt-6 */
            padding: 1.5rem 1rem 1rem 1rem; /* pt-6 pb-4 px-4 */
            background-color: #f8fafc; /* bg-slate-50 */
            border: 1px solid #e2e8f0; /* border border-slate-200 */
            border-radius: 8px; /* rounded-lg */
            box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05); /* shadow-sm */
        }
        .button-wrapper {
            display: flex;
            justify-content: center;
            gap: 1rem; /* space-x-4 */
        }
        button {
            padding: 0.625rem 1.5rem; /* py-2.5 px-6 */
            font-size: 0.875rem; /* text-sm */
            font-weight: 500; /* font-medium */
            border-radius: 6px; /* rounded-md */
            border: none;
            cursor: pointer;
            box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05); /* shadow-sm */
            transition: background-color 0.15s ease-in-out;
        }
        button:focus {
            outline: 2px solid transparent; /* focus:outline-none */
            outline-offset: 2px; /* focus:ring-offset-2 */
        }
        button:disabled {
            opacity: 0.6; /* disabled:opacity-60 */
            cursor: not-allowed; /* disabled:cursor-not-allowed */
        }
        button#show-coverage-btn {
            background-color: #2563eb; /* bg-blue-600 */
            color: white; /* text-white */
        }
        button#show-coverage-btn:hover { background-color: #1d4ed8; /* hover:bg-blue-700 */ }
        button#show-coverage-btn:focus { box-shadow: 0 0 0 2px #f8fafc, 0 0 0 4px #3b82f6; }
        button#reset-btn {
            background-color: #e2e8f0; /* bg-slate-200 */
            color: #1e293b; /* text-slate-800 */
        }
        button#reset-btn:hover { background-color: #cbd5e1; /* hover:bg-slate-300 */ }
        button#reset-btn:focus { box-shadow: 0 0 0 2px #f8fafc, 0 0 0 4px #94a3b8; }

        /* --- Result Area Styling --- */
        .result-container {
            margin-top: 2rem; /* mt-8 */
            padding: 1.5rem; /* p-6 */
            background-color: white; /* bg-white */
            border: 1px solid #e2e8f0; /* border-slate-200 */
            border-radius: 8px; /* rounded-lg */
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06); /* shadow-md */
            display: none; /* Initially hidden */
        }
        .result-title {
            font-size: 1.125rem; /* text-lg */
            font-weight: 600; /* font-semibold */
            color: #1e293b; /* text-slate-800 */
            margin-bottom: 1rem; /* mb-4 */
            text-align: center;
        }
        .overflow-x-auto { overflow-x: auto; } /* For horizontal scroll on small screens */

        /* Result Table Styling */
        .result-table {
            width: 100%; /* min-w-full */
            border-collapse: collapse;
            border: 1px solid #cbd5e1; /* border-slate-300 */
        }
        .result-table th, .result-table td {
            padding: 0.75rem 1rem; /* px-4 py-3 */
            text-align: left;
            white-space: nowrap; /* whitespace-nowrap */
            font-size: 0.875rem; /* text-sm */
            border: 1px solid #e2e8f0; /* Divide lines */
        }
        .result-table th {
            background-color: #f8fafc; /* bg-slate-50 */
            font-weight: 500; /* font-medium */
            color: #64748b; /* text-slate-500 */
            font-size: 0.75rem; /* text-xs */
            text-transform: uppercase; /* uppercase */
            letter-spacing: 0.05em; /* tracking-wider */
            position: sticky; /* Keep header visible when scrolling horizontally */
            top: 0;
            z-index: 10;
        }
         /* Organism name cell (first column) */
        .result-table tbody td:first-child {
            font-weight: 500; /* font-medium */
            color: #0f172a; /* text-slate-900 */
            background-color: #f8fafc; /* bg-slate-50 */
        }
         /* Activity cell styling */
        .activity-cell {
            text-align: center; /* Center the check/cross marks */
            font-weight: 600; /* font-semibold */
        }
        .activity-good { background-color: #d1fae5; /* bg-green-100 */ color: #065f46; /* text-green-800 */ border-color: #a7f3d0; }
        .activity-some { background-color: #fef3c7; /* bg-yellow-100 */ color: #92400e; /* text-yellow-800 */ border-color: #fde68a; }
        .activity-poor { background-color: #fee2e2; /* bg-red-100 */ color: #991b1b; /* text-red-800 */ border-color: #fecaca; }
        .activity-unknown { background-color: #f3f4f6; /* bg-gray-100 */ color: #4b5563; }


        /* Legend */
        .legend-box {
            margin-top: 1rem; /* mt-4 */
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 1rem; /* space-x-4 */
            padding: 0.75rem; /* p-3 */
            background-color: #f8fafc; /* bg-slate-50 */
            border-radius: 6px; /* rounded */
            border: 1px solid #e2e8f0; /* border-slate-200 */
            flex-wrap: wrap; /* Allow wrapping on small screens */
        }
        .legend-item {
            display: flex;
            align-items: center;
            font-size: 0.75rem; /* text-xs */
            color: #334155; /* text-slate-700 */
        }
        .legend-color {
            width: 1rem; /* w-4 */
            height: 1rem; /* h-4 */
            border-radius: 4px; /* rounded */
            border: 1px solid #94a3b8; /* default border */
            margin-right: 0.375rem; /* mr-1.5 */
        }
        .legend-color-good { background-color: #d1fae5; border-color: #6ee7b7; }
        .legend-color-some { background-color: #fef3c7; border-color: #fcd34d; }
        .legend-color-poor { background-color: #fee2e2; border-color: #fca5a5; }

        /* Disclaimer */
        .disclaimer {
            margin-top: 1.5rem; /* mt-6 */
            font-size: 0.75rem; /* text-xs */
            color: #64748b; /* text-slate-500 */
            border-top: 1px solid #e2e8f0; /* border-t border-slate-200 */
            padding-top: 1rem; /* pt-4 */
            font-style: italic;
        }
        .disclaimer strong { font-style: normal; font-weight: bold; }

        /* Utility to hide elements */
        .hidden { display: none; }

        /* Responsive */
        @media (min-width: 768px) {
             body { padding: 2rem; /* md:p-8 */ }
             .main-container { padding: 2rem; /* md:p-8 */ }
        }

    </style>
</head>
<body>
    <div class="main-container">
        <h1 class="main-title">Antibiotic Spectrum Guide</h1>
        <p class="sub-title">Select an organism or an antibiotic to view general antibiotic activity based on common spectrum patterns.</p>

        <form id="antibiotic-form">
            <fieldset>
                <legend>Select Mode & Option</legend>

                <!-- Mode Selection -->
                <div class="mode-selection">
                    <label>
                        <input type="radio" name="viewMode" value="organism" checked> View by Organism
                    </label>
                    <label>
                        <input type="radio" name="viewMode" value="antibiotic"> View by Antibiotic
                    </label>
                </div>

                <!-- Organism Dropdown (Initially Visible) -->
                 <div class="input-group" id="organism-selector-group">
                    <label for="organism-select" class="select-label">Organism / Group:</label>
                    <select id="organism-select" name="organism-select">
                        <option value="">-- Select an Organism --</option>
                        <!-- Options will be populated by JS -->
                    </select>
                </div>

                <!-- Antibiotic Dropdown (Initially Hidden) -->
                 <div class="input-group hidden" id="antibiotic-selector-group">
                    <label for="antibiotic-select" class="select-label">Antibiotic:</label>
                    <select id="antibiotic-select" name="antibiotic-select">
                        <option value="">-- Select an Antibiotic --</option>
                         <!-- Options will be populated by JS -->
                    </select>
                </div>
            </fieldset>

            <!-- Button Container Box -->
            <div class="button-container-box">
                <div class="button-wrapper">
                    <button type="button" id="show-coverage-btn">Show Coverage</button>
                    <button type="reset" id="reset-btn">Reset Form</button>
                </div>
            </div>
            <!-- End Button Container Box -->
        </form>

        <div id="result-container" class="result-container hidden">
            <h3 id="result-title" class="result-title">Antibiotic Activity Spectrum</h3>
            <div class="overflow-x-auto">
                 <div id="result-table-container">
                     <!-- JS will populate the table here -->
                 </div>
            </div>

            <div class="legend-box">
                 <div class="legend-item"><span class="legend-color legend-color-good"></span>Good Activity (✓✓)</div>
                 <div class="legend-item"><span class="legend-color legend-color-some"></span>Some Activity (✓)</div>
                 <div class="legend-item"><span class="legend-color legend-color-poor"></span>Little/No Activity (✕)</div>
            </div>

             <p class="disclaimer">
                <strong>Disclaimer:</strong> This tool provides a general guide based on typical antibiotic spectra (primarily derived from the provided "Antibiotic Spectrum Guide" image). **It is NOT a substitute for local antibiograms, susceptibility testing, infectious disease consultation, or clinical judgment.** Resistance patterns vary significantly by region and institution. This guide does not account for patient allergies, drug interactions, pharmacokinetics, specific infection sites, or detailed resistance mechanisms (e.g., VRE vs. non-VRE Enterococcus distinction is simplified). Use for educational purposes only.
            </p>
        </div>
    </div>

    <script>
        // --- FULL COVERAGE DATA ---
        // Ensure this large object is defined *before* it's used below!
        const coverageData = {
            "Enterococcus": {
                "Vancomycin": "good", "Ampicillin": "some", "Nafcillin": "poor", "Unasyn": "some", "Augmentin": "some", "Cefazolin": "poor",
                "Ceftriaxone": "poor", "Ceftazidime": "poor", "Cefepime": "poor", "Piperacillin/tazobactam": "some",
                "Meropenem": "some", "Ertapenem": "poor", "Azithromycin": "poor", "Ciprofloxacin": "some", "Levofloxacin": "some",
                "TMP/SMX": "poor", "Doxycycline": "some", "Clindamycin": "poor", "Metronidazole": "poor"
            },
            "MRSA": {
                "Vancomycin": "good", "Ampicillin": "poor", "Nafcillin": "poor", "Unasyn": "poor", "Augmentin": "poor", "Cefazolin": "poor",
                "Ceftriaxone": "poor", "Ceftazidime": "poor", "Cefepime": "poor", "Piperacillin/tazobactam": "poor",
                "Meropenem": "poor", "Ertapenem": "poor", "Azithromycin": "poor", "Ciprofloxacin": "poor", "Levofloxacin": "poor",
                "TMP/SMX": "good", "Doxycycline": "good", "Clindamycin": "good", "Metronidazole": "poor"
            },
            "MSSA": {
                "Vancomycin": "good", "Ampicillin": "poor", "Nafcillin": "good", "Unasyn": "good", "Augmentin": "good", "Cefazolin": "good",
                "Ceftriaxone": "good", "Ceftazidime": "poor", "Cefepime": "good", "Piperacillin/tazobactam": "good",
                "Meropenem": "good", "Ertapenem": "good", "Azithromycin": "some", "Ciprofloxacin": "some", "Levofloxacin": "some",
                "TMP/SMX": "good", "Doxycycline": "good", "Clindamycin": "good", "Metronidazole": "poor"
            },
             "Streptococcus_pneumoniae": {
                "Vancomycin": "good", "Ampicillin": "some", "Nafcillin": "poor", "Unasyn": "some", "Augmentin": "good", "Cefazolin": "poor",
                "Ceftriaxone": "good", "Ceftazidime": "poor", "Cefepime": "good", "Piperacillin/tazobactam": "some",
                "Meropenem": "good", "Ertapenem": "some", "Azithromycin": "some", "Ciprofloxacin": "poor", "Levofloxacin": "good",
                "TMP/SMX": "some", "Doxycycline": "some", "Clindamycin": "some", "Metronidazole": "poor"
            },
             "Beta_hemolytic_strep": { // e.g. GAS, GBS
                "Vancomycin": "good", "Ampicillin": "good", "Nafcillin": "poor", "Unasyn": "good", "Augmentin": "good", "Cefazolin": "good",
                "Ceftriaxone": "good", "Ceftazidime": "poor", "Cefepime": "good", "Piperacillin/tazobactam": "good",
                "Meropenem": "good", "Ertapenem": "good", "Azithromycin": "some", "Ciprofloxacin": "poor", "Levofloxacin": "some",
                "TMP/SMX": "poor", "Doxycycline": "poor", "Clindamycin": "good", "Metronidazole": "poor"
            },
            "Gram_negatives_community": { // e.g., E. coli, Klebsiella, Proteus (non-hospital)
                "Vancomycin": "poor", "Ampicillin": "some", "Nafcillin": "poor", "Unasyn": "some", "Augmentin": "some", "Cefazolin": "some",
                "Ceftriaxone": "good", "Ceftazidime": "good", "Cefepime": "good", "Piperacillin/tazobactam": "good",
                "Meropenem": "good", "Ertapenem": "good", "Azithromycin": "poor", "Ciprofloxacin": "good", "Levofloxacin": "good",
                "TMP/SMX": "good", "Doxycycline": "poor", "Clindamycin": "poor", "Metronidazole": "poor"
            },
             "Gram_negatives_hospital": { // Broader resistance expected
                "Vancomycin": "poor", "Ampicillin": "poor", "Nafcillin": "poor", "Unasyn": "poor", "Augmentin": "poor", "Cefazolin": "poor",
                "Ceftriaxone": "some", "Ceftazidime": "good", "Cefepime": "good", "Piperacillin/tazobactam": "good",
                "Meropenem": "good", "Ertapenem": "some", "Azithromycin": "poor", "Ciprofloxacin": "some", "Levofloxacin": "some",
                "TMP/SMX": "some", "Doxycycline": "poor", "Clindamycin": "poor", "Metronidazole": "poor"
            },
             "Enterobacter_other_AmpC": {
                "Vancomycin": "poor", "Ampicillin": "poor", "Nafcillin": "poor", "Unasyn": "poor", "Augmentin": "poor", "Cefazolin": "poor",
                "Ceftriaxone": "poor", "Ceftazidime": "some", "Cefepime": "good", "Piperacillin/tazobactam": "some",
                "Meropenem": "good", "Ertapenem": "good", "Azithromycin": "poor", "Ciprofloxacin": "some", "Levofloxacin": "some",
                "TMP/SMX": "some", "Doxycycline": "poor", "Clindamycin": "poor", "Metronidazole": "poor"
            },
             "Pseudomonas": {
                "Vancomycin": "poor", "Ampicillin": "poor", "Nafcillin": "poor", "Unasyn": "poor", "Augmentin": "poor", "Cefazolin": "poor",
                "Ceftriaxone": "poor", "Ceftazidime": "good", "Cefepime": "good", "Piperacillin/tazobactam": "good",
                "Meropenem": "good", "Ertapenem": "poor", "Azithromycin": "poor", "Ciprofloxacin": "good", "Levofloxacin": "good",
                "TMP/SMX": "poor", "Doxycycline": "poor", "Clindamycin": "poor", "Metronidazole": "poor"
            },
            "ESBL_producers": { // e.g., E. coli, Klebsiella
                "Vancomycin": "poor", "Ampicillin": "poor", "Nafcillin": "poor", "Unasyn": "poor", "Augmentin": "poor", "Cefazolin": "poor",
                "Ceftriaxone": "poor", "Ceftazidime": "poor", "Cefepime": "some", "Piperacillin/tazobactam": "some",
                "Meropenem": "good", "Ertapenem": "good", "Azithromycin": "poor", "Ciprofloxacin": "some", "Levofloxacin": "some",
                "TMP/SMX": "some", "Doxycycline": "poor", "Clindamycin": "poor", "Metronidazole": "poor"
            },
            "Mouth_anaerobes": { // e.g., Peptostreptococcus, Prevotella (oral)
                "Vancomycin": "good", "Ampicillin": "good", "Nafcillin": "poor", "Unasyn": "good", "Augmentin": "good", "Cefazolin": "some",
                "Ceftriaxone": "some", "Ceftazidime": "poor", "Cefepime": "some", "Piperacillin/tazobactam": "good",
                "Meropenem": "good", "Ertapenem": "good", "Azithromycin": "poor", "Ciprofloxacin": "poor", "Levofloxacin": "some",
                "TMP/SMX": "poor", "Doxycycline": "poor", "Clindamycin": "good", "Metronidazole": "good"
            },
            "Gut_anaerobes": { // e.g., Bacteroides fragilis
                "Vancomycin": "poor", "Ampicillin": "poor", "Nafcillin": "poor", "Unasyn": "good", "Augmentin": "good", "Cefazolin": "poor",
                "Ceftriaxone": "poor", "Ceftazidime": "poor", "Cefepime": "poor", "Piperacillin/tazobactam": "good",
                "Meropenem": "good", "Ertapenem": "good", "Azithromycin": "poor", "Ciprofloxacin": "poor", "Levofloxacin": "some",
                "TMP/SMX": "poor", "Doxycycline": "poor", "Clindamycin": "some", "Metronidazole": "good"
            },
            "Atypicals": { // e.g., Mycoplasma, Chlamydia, Legionella
                "Vancomycin": "poor", "Ampicillin": "poor", "Nafcillin": "poor", "Unasyn": "poor", "Augmentin": "poor", "Cefazolin": "poor",
                "Ceftriaxone": "poor", "Ceftazidime": "poor", "Cefepime": "poor", "Piperacillin/tazobactam": "poor",
                "Meropenem": "poor", "Ertapenem": "poor", "Azithromycin": "good", "Ciprofloxacin": "some", "Levofloxacin": "good",
                "TMP/SMX": "poor", "Doxycycline": "good", "Clindamycin": "poor", "Metronidazole": "poor"
            }
        };

        // --- Derive Organism and Antibiotic Lists from Data ---
        const allOrganisms = Object.keys(coverageData);
        const antibiotics = Object.keys(coverageData[allOrganisms[0]] || {}); // Get antibiotics from the first organism entry


        // --- Get references to form elements ---
        const form = document.getElementById('antibiotic-form');
        const modeRadios = document.querySelectorAll('input[name="viewMode"]');
        const organismSelectorGroup = document.getElementById('organism-selector-group');
        const antibioticSelectorGroup = document.getElementById('antibiotic-selector-group');
        const organismSelect = document.getElementById('organism-select');
        const antibioticSelect = document.getElementById('antibiotic-select');
        const showCoverageBtn = document.getElementById('show-coverage-btn');
        const resetBtn = document.getElementById('reset-btn');
        const resultContainer = document.getElementById('result-container');
        const resultTitle = document.getElementById('result-title');
        const resultTableContainer = document.getElementById('result-table-container');

        // --- Populate Dropdowns ---
        function populateDropdowns() {
            // Clear existing options first (important if called multiple times)
            organismSelect.innerHTML = '<option value="">-- Select an Organism --</option>';
            antibioticSelect.innerHTML = '<option value="">-- Select an Antibiotic --</option>';

            // Populate Organisms
            allOrganisms.sort().forEach(orgKey => {
                const option = document.createElement('option');
                option.value = orgKey;
                option.textContent = orgKey.replace(/_/g, ' '); // User-friendly name
                organismSelect.appendChild(option);
            });

            // Populate Antibiotics
            antibiotics.sort().forEach(abx => {
                const option = document.createElement('option');
                option.value = abx;
                option.textContent = abx;
                antibioticSelect.appendChild(option);
            });
        }

        // --- Mode Switching Logic ---
        function handleModeChange() {
            const selectedMode = document.querySelector('input[name="viewMode"]:checked').value;
            if (selectedMode === 'organism') {
                organismSelectorGroup.classList.remove('hidden');
                antibioticSelectorGroup.classList.add('hidden');
                antibioticSelect.value = ""; // Reset other dropdown
            } else { // antibiotic mode
                organismSelectorGroup.classList.add('hidden');
                antibioticSelectorGroup.classList.remove('hidden');
                organismSelect.value = ""; // Reset other dropdown
            }
            // Hide results when mode changes
            resultContainer.classList.add('hidden');
            resultTableContainer.innerHTML = '';
        }

        // --- Display Logic ---
        function displayCoverage() {
            const selectedMode = document.querySelector('input[name="viewMode"]:checked').value;
            let tableHTML = '';
            let titleText = '';

            if (selectedMode === 'organism') {
                // --- VIEW BY ORGANISM ---
                const selectedOrganism = organismSelect.value;
                if (!selectedOrganism) {
                    alert("Please select an organism.");
                    return;
                }
                titleText = `Antibiotic Activity vs. ${selectedOrganism.replace(/_/g, ' ')}`;
                const organismData = coverageData[selectedOrganism]; // Access the correct data

                if (!organismData) { // Add check if data somehow missing
                    resultTableContainer.innerHTML = '<p style="color: red; text-align: center;">Error: Coverage data not found for the selected organism.</p>';
                    resultContainer.classList.remove('hidden');
                    return;
                }

                // Build Table Header (Antibiotics as columns)
                tableHTML = '<table class="result-table"><thead><tr><th>Organism / Group</th>';
                antibiotics.forEach(abx => {
                    tableHTML += `<th>${abx.replace('/', '/<wbr>')}</th>`;
                });
                tableHTML += '</tr></thead><tbody>';

                // Build Table Body Row for the selected organism
                tableHTML += '<tr>';
                tableHTML += `<td>${selectedOrganism.replace(/_/g, ' ')}</td>`; // First cell is organism name

                antibiotics.forEach(abx => {
                    const activity = organismData[abx] || 'unknown'; // Use data for the selected organism
                    const { activityClass, activityText } = getActivityStyling(activity);
                    tableHTML += `<td class="activity-cell ${activityClass}">${activityText}</td>`;
                });
                tableHTML += '</tr></tbody></table>';

            } else {
                 // --- VIEW BY ANTIBIOTIC ---
                const selectedAntibiotic = antibioticSelect.value;
                if (!selectedAntibiotic) {
                    alert("Please select an antibiotic.");
                    return;
                }
                titleText = `Spectrum of Activity for ${selectedAntibiotic}`;

                // Build Table Header
                 tableHTML = '<table class="result-table"><thead><tr><th>Organism / Group</th><th>Activity Level</th></tr></thead><tbody>';

                 // Build Table Body Rows (one per organism)
                 allOrganisms.forEach(orgKey => {
                    const organismData = coverageData[orgKey];
                    const activity = organismData?.[selectedAntibiotic] || 'unknown'; // Get activity for THIS antibiotic
                    const { activityClass, activityText } = getActivityStyling(activity);

                     tableHTML += '<tr>';
                     tableHTML += `<td>${orgKey.replace(/_/g, ' ')}</td>`; // First cell is organism name
                     tableHTML += `<td class="activity-cell ${activityClass}">${activityText}</td>`; // Second cell is activity vs selected antibiotic
                     tableHTML += '</tr>';
                 });

                tableHTML += '</tbody></table>';
            }

            resultTitle.textContent = titleText;
            resultTableContainer.innerHTML = tableHTML;
            resultContainer.classList.remove('hidden'); // Show results
            // Scroll to results
            resultContainer.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }

         // Helper function for table cell styling
         function getActivityStyling(activity) {
            let activityClass = 'activity-unknown';
            let activityText = '?';

            switch (activity) {
                case 'good':
                    activityClass = 'activity-good';
                    activityText = '✓✓';
                    break;
                case 'some':
                    activityClass = 'activity-some';
                    activityText = '✓';
                    break;
                case 'poor':
                    activityClass = 'activity-poor';
                    activityText = '✕';
                    break;
            }
             return { activityClass, activityText };
         }

        // --- Form Reset Logic ---
        function resetForm() {
            form.reset();
             // Set radio button back to default and trigger mode change
            document.querySelector('input[name="viewMode"][value="organism"]').checked = true;
            handleModeChange(); // Ensure correct dropdown shows and results are hidden
            // Hide results explicitly
            resultContainer.classList.add('hidden');
            resultTableContainer.innerHTML = '';

             try { // Scroll to top
                form.scrollIntoView({ behavior: 'smooth', block: 'start' });
            } catch (e) { /* ignore */ }
        }

        // --- Event Listeners ---
        modeRadios.forEach(radio => radio.addEventListener('change', handleModeChange));
        showCoverageBtn.addEventListener('click', displayCoverage);
        resetBtn.addEventListener('click', resetForm);

        // Optional: Hide result if dropdown changes before clicking button again
        organismSelect.addEventListener('change', () => resultContainer.classList.add('hidden'));
        antibioticSelect.addEventListener('change', () => resultContainer.classList.add('hidden'));

        // --- Initial Setup ---
        populateDropdowns(); // Populate the dropdowns on load
        resetForm(); // Initialize form state on load

    </script>

</body>
</html>
